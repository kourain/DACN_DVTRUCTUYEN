"use strict";(self.webpackChunkdivine_shop_gatsby=self.webpackChunkdivine_shop_gatsby||[]).push([[5259],{5259:function(e,n,t){t.r(n),t.d(n,{default:function(){return z}});var s=t(7294),a=t(5649),i=t(5142),l=t.p+"static/368e705d45bfc8742aa9d20dbcf4c78c.svg",c=t(5453),r=t.p+"static/0b314f30be0025da88c475e87a222e5a.svg",o=t(1597),d=t(3816),h=t(1151),u=t(4742),p=t(2340),g=t(6553),m=t(5893);var b=e=>{let{title:n,description:t,image:s,children:a}=e;return(0,m.jsxs)("div",{className:"ta Qe",children:[(0,m.jsxs)("div",{className:"af og Qf Oe",children:[(0,m.jsx)("h3",{className:"vc",children:n}),(0,m.jsx)("div",{className:"fe",children:t}),a]}),(0,m.jsx)("div",{className:"va Mf _e mc jc",children:(0,m.jsx)(u.Z,{src:s,alt:"Đăng nhập / Đăng ký"})})]})},x=t(4379),j=t(7644),v=t(8489);var f=(e,n)=>(0,s.useEffect)((()=>{if(!n)return;const t=t=>{var s;t.origin===window.location.origin&&(null===(s=t.data)||void 0===s?void 0:s.sender)===e&&n(t)};return window.addEventListener("message",t),()=>window.removeEventListener("message",t)}),[n,e]),k=t(5092);const Z=(0,s.createContext)();var N=Z;const w=()=>(0,s.useContext)(Z),y=(e,n)=>{const{setError:t}=w();f(k.fY,(s=>{let{data:{payload:{hash:a}}}=s;const{state:l,token:c}=n(a.substr(1));if(!l||!c)return;const r=e({state:l,token:c},{onFulfilled:e=>{(0,i.q1)(e),e.username||(0,o.c4)("/user/profile")},onError:t});v.Z.loading("Đang đăng nhập",r.then((e=>e.username?"Đăng nhập thành công":"Bạn vui lòng cập nhật tên đăng nhập")))}))},I=()=>{const{data:{state:e,clients:n}={}}=(0,x.Z)("/api/user/login/oauth"),{loading:t,mutate:a}=(0,j.Z)("/api/user/login/google"),i=(0,s.useCallback)((e=>{const{state:n,id_token:t}=(0,g.parse)(e);return{state:n,token:t}}),[]);y(a,i);return(0,m.jsx)("button",{type:"button",className:"b",title:"Đăng nhập bằng Google",disabled:t||!e,onClick:()=>{const t=`https://accounts.google.com/o/oauth2/v2/auth${(0,g.stringify)({state:e,nonce:Math.random(),redirect_uri:`${window.location.origin}${k.fY}`,client_id:n.google,scope:"openid email profile",response_type:"id_token",prompt:"select_account"})}`;open(t,"divine_shop_login","width=600,height=640,location=0")},children:(0,m.jsx)(u.Z,{className:"gb Pa",src:r,alt:"Google"})})},_=()=>{const{data:{state:e,clients:n}={}}=(0,x.Z)("/api/user/login/oauth"),{loading:t,mutate:a}=(0,j.Z)("/api/user/login/facebook"),i=(0,s.useCallback)((e=>{const{state:n,access_token:t}=(0,g.parse)(e);return{state:n,token:t}}),[]);y(a,i);return(0,m.jsx)("button",{type:"button",className:"b",title:"Đăng nhập bằng Facebook",disabled:t||!e,onClick:()=>{const t=`https://www.facebook.com/v11.0/dialog/oauth${(0,g.stringify)({state:e,client_id:n.facebook,redirect_uri:`${window.location.origin}${k.fY}`,response_type:"token",scope:"public_profile,email"})}`;open(t,"divine_shop_login","width=600,height=640,location=0")},children:(0,m.jsx)(u.Z,{className:"gb Pa",src:c.Z,alt:"Facebook"})})},C=()=>{const{setPage:e}=w();return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(h.Z,{children:(0,m.jsx)(d.II,{name:"email",label:"Email hoặc tên đăng nhập",required:!0,minLength:6})}),(0,m.jsx)(h.Z,{children:(0,m.jsx)(d.II,{name:"password",type:"password",label:"Mật khẩu",required:!0,minLength:4,maxLength:50})}),(0,m.jsx)("a",{className:"ge ra bc",onClick:()=>e(p.Qj),children:"Bạn quên mật khẩu?"}),(0,m.jsx)("button",{type:"submit",className:"b c db",children:"Đăng nhập"}),(0,m.jsxs)("div",{className:"ta jc",children:[(0,m.jsx)("div",{className:"Vb f"}),(0,m.jsx)("div",{className:"Gd he",children:"Hoặc đăng nhập bằng"}),(0,m.jsx)("div",{className:"Vb f"})]}),(0,m.jsxs)("div",{className:"ta mc Ke",children:[(0,m.jsx)(I,{}),(0,m.jsx)(_,{})]})]})},L=()=>{const{setPage:e}=w();return(0,m.jsxs)("div",{className:"Ne",children:[(0,m.jsx)("button",{type:"button",className:"Wd Zd tf",onClick:()=>e(p.xr),children:"Đăng nhập"}),(0,m.jsx)("button",{type:"button",className:"Wd Zd he tf",onClick:()=>e(p._5),children:"Đăng ký"})]})};var q=()=>(0,m.jsx)(b,{title:(0,m.jsx)(L,{}),description:"Đăng nhập để theo dõi đơn hàng, lưu danh sách sản phẩm yêu thích và nhận nhiều ưu đãi hấp dẫn",image:l,children:(0,m.jsx)(C,{})}),M=t.p+"static/235dccb09069e3d4eebc6227236f9dc2.svg",E=t(550);const P=()=>(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(h.Z,{children:(0,m.jsx)(d.II,{name:"fullname",label:"Họ và tên",required:!0,maxLength:50})}),(0,m.jsx)(h.Z,{children:(0,m.jsx)(d.II,{name:"email",type:"email",label:"Email",required:!0,minLength:6})}),(0,m.jsx)(h.Z,{children:(0,m.jsx)(d.II,{name:"username",label:"Tên đăng nhập",required:!0,minLength:6,maxLength:16,pattern:"[a-zA-Z0-9]+"})}),(0,m.jsx)(h.Z,{children:(0,m.jsx)(d.II,{name:"password",type:"password",label:"Mật khẩu",required:!0,minLength:6,maxLength:50})}),(0,m.jsx)(h.Z,{children:(0,m.jsx)(d.II,{name:"re_password",type:"password",label:"Nhập lại mật khẩu",required:!0,minLength:6,maxLength:50})}),(0,m.jsx)(h.Z,{children:(0,m.jsx)(d.II,{name:"telephone",label:"Số điện thoại (không bắt buộc)"})}),(0,m.jsx)(h.Z,{children:(0,m.jsx)(d.II,{name:"affiliate_code",type:"tel",label:"Mã giới thiệu (nếu có)"})}),(0,m.jsx)(h.Z,{children:(0,m.jsx)(d.XZ,{name:"newsletter",value:"1",children:"Tôi đồng ý nhận thông tin marketing mới từ Divine Shop."})}),(0,m.jsx)("button",{type:"submit",className:"b c db",children:"Tạo tài khoản"}),(0,m.jsxs)("small",{className:"fe ra",children:["Khi bấm ",(0,m.jsx)("span",{className:"Zd",children:"Tạo tài khoản"}),", bạn đã đồng ý với ",(0,m.jsx)(E.Z,{to:"https://help.divineshop.vn/gioi-thieu/dieu-khoan-dich-vu",className:"Zd",children:"Điều khoản dịch vụ của Divine Shop"})]})]}),K=()=>{const{setPage:e}=w();return(0,m.jsxs)("div",{className:"ta Ne",children:[(0,m.jsx)("button",{type:"button",className:"Wd Zd he tf",onClick:()=>e(p.xr),children:"Đăng nhập"}),(0,m.jsx)("button",{type:"button",className:"Wd Zd tf",onClick:()=>e(p._5),children:"Đăng ký"})]})};var Q=()=>(0,m.jsx)(b,{title:(0,m.jsx)(K,{}),description:"Đăng ký để theo dõi đơn hàng, lưu danh sách sản phẩm yêu thích và nhận nhiều ưu đãi hấp dẫn",image:M,children:(0,m.jsx)(P,{})}),$=t.p+"static/c92dc142033ca6a66cda62bc0aec491b.svg",J=t(6801),F=t(9979);var S=()=>{const{setPage:e}=w();return(0,m.jsxs)(b,{title:"Đặt lại mật khẩu",description:"Bạn vui lòng hoàn tất các thông tin xác thực bên dưới để chúng tôi đặt lại mật khẩu cho tài khoản của bạn",image:$,children:[(0,m.jsx)(h.Z,{children:(0,m.jsx)(d.II,{name:"email",label:"Email hoặc tên đăng nhập",required:!0,minLength:6})}),(0,m.jsx)(h.Z,{children:(0,m.jsx)(d.II,{name:"password",type:"password",label:"Mật khẩu mới",required:!0,minLength:6,maxLength:50})}),(0,m.jsx)(h.Z,{children:(0,m.jsx)(d.II,{name:"confirm_password",type:"password",label:"Nhập lại mật khẩu mới",required:!0,minLength:6,maxLength:50})}),(0,m.jsx)("button",{type:"submit",className:"b c db",children:"Đặt lại mật khẩu"}),(0,m.jsxs)("a",{className:"ta jc Ee ge bc",onClick:()=>e(p.xr),children:[(0,m.jsx)(J.Z,{className:"Cb Da",icon:F.qb}),(0,m.jsx)("div",{children:"Quay lại trang đăng nhập"})]})]})};var D=()=>(0,m.jsxs)(b,{title:"Nhập mã xác thực",description:"Vui lòng nhập mã OTP được gửi tới email của bạn để xác thực",image:l,children:[(0,m.jsx)(h.Z,{children:(0,m.jsx)(d.II,{name:"code",label:"Mã xác thực",required:!0,minLength:6})}),(0,m.jsx)("button",{type:"submit",className:"b c db",children:"Xác nhận"})]});var T=()=>{const{setPage:e,interruption:{payload:{email:n}}}=w();return(0,m.jsxs)(b,{title:"Nhập email của bạn",description:"Vui lòng nhập email của bạn để đăng nhập với Facebook",image:l,children:[(0,m.jsx)(h.Z,{children:(0,m.jsx)(d.II,{name:"email",label:"Email",defaultValue:n,required:!0,minLength:6})}),(0,m.jsx)("button",{type:"submit",className:"b c db",onClick:()=>e(p.QK),children:"Xác nhận"})]})};const V={[p.xr]:q,[p._5]:Q,[p.Qj]:S,[a.MJ]:D,[a.xK]:T},W={[p.xr]:"/api/user/login",[p._5]:"/api/user/signup",[p.Qj]:"/api/user/password/reset",[p.xr+a.MJ]:"/api/user/login/otp",[p._5+a.MJ]:"/api/user/signup/otp",[p.Qj+a.MJ]:"/api/user/password/reset/otp",[p.QK+a.MJ]:"/api/user/signup/facebook/otp",[a.xK]:"/api/user/signup/facebook"};var B=e=>{let{loading:n}=e;const{page:t,interruption:l,submit:c,setError:r}=w(),[o,d]=((e,n)=>{if(!n)return[V[e],W[e]];const{payload:{reason:t}}=n;switch(t){case a.MJ:return[V[a.MJ],W[e+a.MJ]];case a.xK:return[V[a.xK],W[a.xK]];default:throw Error(`unknown state ${e} ${t}`)}})(t,l),h=(0,s.useCallback)((e=>{const n=c(e,{onFulfilled:i.q1,onError:r});v.Z.loading("Đang đăng nhập",n.then((()=>"Đăng nhập thành công")))}),[c,r]);return(0,m.jsx)("form",{action:d,onSubmit:h,children:(0,m.jsx)("fieldset",{disabled:n,children:(0,m.jsx)(o,{})})})},G=t(8656),X=t.n(G),Y=t(8471);var z=e=>{let{page:n}=e;const{loading:t,submit:a}=(0,Y.Z)(),{0:i,1:l}=(0,s.useState)(n),{0:c,1:r}=(0,s.useState)(null),o=(0,s.useCallback)((e=>{e instanceof X()&&r(e)}),[r]),d=(0,s.useMemo)((()=>({page:i,interruption:c,submit:a,setPage:l,setInterruption:r,setError:o})),[i,c,o,a]);return(0,m.jsx)(N.Provider,{value:d,children:(0,m.jsx)(B,{loading:t})})}},8471:function(e,n,t){var s=t(7294),a=t(5938),i=t(1339);n.Z=e=>{const n=(0,a.Z)(e),{submit:t}=n,l=(0,s.useCallback)((function(e,n){var s,a;let{captcha:l,body:c,...r}=void 0===n?{}:n;const o=null==e?void 0:e.target;if(!1===l||"false"===(null==o||null===(s=o.dataset)||void 0===s?void 0:s.captcha))return t(e,{body:c,...r});var d;o&&(null===(d=e.preventDefault)||void 0===d||d.call(e));const h=(null==o||null===(a=o.getAttribute)||void 0===a?void 0:a.call(o,"action"))||r.url;return(0,i.ZP)(h).then((n=>t(e,{body:{...c,captcha:n},...r})))}),[t]);return(0,s.useEffect)((()=>((0,i.zD)(),(0,i.$Z)(),i.Cp)),[]),{...n,submit:l}}}}]);